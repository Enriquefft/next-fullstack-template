# Implementation Plan Template

This document describes the structure and format of `plan.md` that gets generated by `/implement-prd`.

## Purpose

`plan.md` lives in the **project root** and serves as the implementation roadmap. It breaks down the PRD into actionable phases, steps, and tasks with explicit test requirements.

## Structure

### Header

```markdown
# Project Implementation Plan

**Generated from**: `.claude/prd/` on [YYYY-MM-DD]
**Project**: [Project name from 00-overview.md]
**Last Updated**: [YYYY-MM-DD]
```

### Phases

Phases correspond to implementation milestones (usually from `00-overview.md`):

```markdown
## Phase 1: MVP

**Goal**: [Phase objective from PRD]

**Features**:
- [Feature 1]
- [Feature 2]
- [Feature 3]
```

### Steps

Each step implements a specific feature/flow from the PRD:

```markdown
### Step 1.1: User Signup

**Flow Reference**: `.claude/prd/01-flows/auth/signup-flows.md`

**Related PRD Files**:
- Data Models: `02-data-models.md` → User, Session, Verification tables
- API Design: `03-api-design.md` → `signUp()` action
- UI Components: `04-ui-components.md` → SignUpForm component
```

### Tasks

Granular, checkable implementation tasks:

```markdown
**Tasks**:
- [ ] Create User table schema in `src/db/schema/user.ts`
- [ ] Create Session table schema in `src/db/schema/session.ts`
- [ ] Create Verification table schema in `src/db/schema/verification.ts`
- [ ] Run `bun run db:push` to apply schema changes
- [ ] Implement `signUp()` server action in `src/app/actions/auth.ts`
- [ ] Add Zod validation schema for signup
- [ ] Implement password hashing with bcrypt
- [ ] Create SignUpForm component in `src/components/forms/SignUpForm.tsx`
- [ ] Create signup page at `src/app/(auth)/signup/page.tsx`
- [ ] Add signup page metadata (title, description)
```

### Test Requirements

**Critical**: Explicitly list all required tests:

```markdown
**Test Requirements**:

**Unit Tests** (`tests/actions/auth.test.ts`):
- [ ] Test `signUp()` with valid input creates user
- [ ] Test `signUp()` validates email format
- [ ] Test `signUp()` validates password strength requirements
- [ ] Test `signUp()` rejects duplicate email
- [ ] Test `signUp()` hashes password correctly
- [ ] Test `signUp()` creates session
- [ ] Test `signUp()` creates verification token

**E2E Tests** (`e2e/tests/auth.spec.ts`):
- [ ] Flow 1: User can sign up with valid email/password (happy path)
- [ ] Flow 2: Shows error when email already exists
- [ ] Flow 3: Shows error for invalid email format
- [ ] Flow 4: Shows error for weak password
- [ ] Flow 5: User can verify email with valid token
- [ ] Flow 6: Shows error for expired verification token
```

## Complete Example

```markdown
# Project Implementation Plan

**Generated from**: `.claude/prd/` on 2024-01-15
**Project**: TaskFlow - Team Task Management App
**Last Updated**: 2024-01-15

---

## Phase 1: MVP

**Goal**: Launch core task management features with user authentication

**Features**:
- User signup and login
- Create and manage tasks
- Basic team collaboration

---

### Step 1.1: User Signup

**Flow Reference**: `.claude/prd/01-flows/auth/signup-flows.md`

**Related PRD Files**:
- Data Models: `02-data-models.md` → User, Session, Verification tables
- API Design: `03-api-design.md` → `signUp()` action
- UI Components: `04-ui-components.md` → SignUpForm component

**Tasks**:
- [ ] Create User table schema in `src/db/schema/user.ts`
- [ ] Create Session table schema in `src/db/schema/session.ts`
- [ ] Create Verification table schema in `src/db/schema/verification.ts`
- [ ] Run `bun run db:push` to apply schema changes
- [ ] Implement `signUp()` server action in `src/app/actions/auth.ts`
- [ ] Add Zod validation schema for email and password
- [ ] Implement password hashing with bcrypt (10 rounds)
- [ ] Implement email verification token generation
- [ ] Create SignUpForm component using TanStack Form
- [ ] Create signup page at `src/app/(auth)/signup/page.tsx`
- [ ] Add loading and error states to signup form
- [ ] Add signup page metadata and SEO

**Test Requirements**:

**Unit Tests** (`tests/actions/auth.test.ts`):
- [ ] Test `signUp()` with valid input creates user in database
- [ ] Test `signUp()` validates email format (rejects invalid emails)
- [ ] Test `signUp()` validates password strength (min 8 chars, uppercase, lowercase, number)
- [ ] Test `signUp()` rejects duplicate email with appropriate error
- [ ] Test `signUp()` hashes password correctly (bcrypt)
- [ ] Test `signUp()` creates session with correct expiration
- [ ] Test `signUp()` creates verification token

**E2E Tests** (`e2e/tests/auth.spec.ts`):
- [ ] Flow 1: User can sign up with valid email/password (happy path)
  - Navigate to /signup
  - Fill form with valid credentials
  - Submit form
  - Verify redirect to /verify-email
  - Verify user created in database with emailVerified: false
- [ ] Flow 2: Shows error when email already exists
  - Create existing user first
  - Attempt signup with same email
  - Verify error message "This email is already registered"
- [ ] Flow 3: Shows error for invalid email format
  - Enter invalid email formats
  - Verify validation error message
- [ ] Flow 4: Shows error for weak password
  - Enter passwords that don't meet requirements
  - Verify error with requirement details
- [ ] Flow 5: User can verify email with valid token
  - Sign up new user
  - Use verification token
  - Verify emailVerified updated to true
  - Verify redirect to dashboard
- [ ] Flow 6: Shows error for expired verification token
  - Use expired token
  - Verify error message
  - Verify "Resend verification" button shown

---

### Step 1.2: User Login

**Flow Reference**: `.claude/prd/01-flows/auth/login-flows.md`

**Related PRD Files**:
- Data Models: `02-data-models.md` → User, Session tables
- API Design: `03-api-design.md` → `signIn()` action
- UI Components: `04-ui-components.md` → SignInForm component

**Tasks**:
- [ ] Implement `signIn()` server action in `src/app/actions/auth.ts`
- [ ] Add Zod validation for login form
- [ ] Implement password verification with bcrypt
- [ ] Implement session creation on successful login
- [ ] Create SignInForm component using TanStack Form
- [ ] Create login page at `src/app/(auth)/login/page.tsx`
- [ ] Add "Forgot password?" link to login form
- [ ] Add Google OAuth "Continue with Google" button
- [ ] Add login page metadata

**Test Requirements**:

**Unit Tests** (`tests/actions/auth.test.ts`):
- [ ] Test `signIn()` with valid credentials creates session
- [ ] Test `signIn()` rejects invalid email
- [ ] Test `signIn()` rejects incorrect password
- [ ] Test `signIn()` rejects unverified email
- [ ] Test `signIn()` verifies password using bcrypt
- [ ] Test session token generation and expiration

**E2E Tests** (`e2e/tests/auth.spec.ts`):
- [ ] Flow 1: User can log in with email/password (happy path)
- [ ] Flow 2: Shows error for invalid credentials
- [ ] Flow 3: Redirects unverified users to /verify-email
- [ ] Flow 4: User can log in with Google OAuth
- [ ] Flow 5: User can log out

---

### Step 1.3: Task Creation

**Flow Reference**: `.claude/prd/01-flows/tasks/create-task-flows.md`

**Related PRD Files**:
- Data Models: `02-data-models.md` → Task table
- API Design: `03-api-design.md` → `createTask()` action
- UI Components: `04-ui-components.md` → CreateTaskForm, TaskCard

**Tasks**:
- [ ] Create Task table schema in `src/db/schema/task.ts`
- [ ] Add foreign key relationship to User table
- [ ] Run `bun run db:push`
- [ ] Implement `createTask()` server action
- [ ] Add Zod validation for task fields
- [ ] Create CreateTaskForm component
- [ ] Create TaskCard display component
- [ ] Add task creation to dashboard page
- [ ] Implement task list display

**Test Requirements**:

**Unit Tests** (`tests/actions/tasks.test.ts`):
- [ ] Test `createTask()` with valid input
- [ ] Test `createTask()` validates required fields
- [ ] Test `createTask()` validates max length constraints
- [ ] Test `createTask()` associates task with correct user

**E2E Tests** (`e2e/tests/tasks.spec.ts`):
- [ ] Flow 1: User can create a task (happy path)
- [ ] Flow 2: Shows error for missing required fields
- [ ] Flow 3: Shows error for invalid input
- [ ] Flow 4: Created task appears in task list

---

## Phase 2: Enhancement

### Step 2.1: Task Assignment

[Similar structure to Phase 1 steps]

---

## Phase 3: Polish

### Step 3.1: Email Notifications

[Similar structure to Phase 1 steps]

---

## Notes

- Check off tasks as completed
- Update test requirements when tests are written
- Keep plan in sync with PRD if requirements change
- Use plan.md as source of truth for `/next-step` command
```

## Key Principles

1. **Each step maps to specific flow file** - Direct traceability
2. **Tasks are granular and checkable** - Can mark off as completed
3. **Test requirements are explicit** - No ambiguity about what to test
4. **Phases match PRD priorities** - From `01-flows/_index.md`
5. **Related files are referenced** - Easy to find relevant PRD sections

## Maintenance

When PRD changes:
- Update plan.md to reflect new requirements
- Add new steps for new features
- Update test requirements if flows change
- Mark updated sections with date

## Usage with `/next-step`

The `/next-step` command:
1. Reads plan.md to find next uncompleted step
2. Reads the flow file referenced in that step
3. Implements all tasks for that step
4. Writes all required tests
5. Marks step as complete
6. Reports completion and waits for next `/next-step`
